<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dashboard Dinámico</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        #loginForm, #dashboard {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .hidden {
            display: none;
        }

        #module-content {
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 8px;
        }

        #logoutBtn {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <!-- FORMULARIO DE LOGIN -->
    <div id="loginForm">
        <h3 class="text-center">Iniciar Sesión</h3>
        <div id="loginError" class="alert alert-danger hidden" role="alert">
            Credenciales incorrectas. Inténtalo de nuevo.
        </div>
        <form id="loginFormElement">
            <div class="form-group">
                <label for="username">Usuario</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary btn-block">Ingresar</button>
        </form>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="hidden">
        <h3 class="text-center">Bienvenido al Dashboard</h3>
        <div class="text-center mb-4">
            <button class="btn btn-info" onclick="loadModule('perfil')">Perfil</button>
            <button class="btn btn-info" onclick="loadModule('configuracion')">Configuración</button>
            <button class="btn btn-info" onclick="loadModule('reportes')">Reportes</button>
        </div>
        <div id="module-content" class="text-center">
            <p>Selecciona un módulo para ver su contenido.</p>
        </div>
        <button id="logoutBtn" class="btn btn-danger btn-block" onclick="logout()">Cerrar Sesión</button>
    </div>

    <script>
        // API URL
        const apiUrl = "https://ghostwhite-wasp-985227.hostingersite.com/api_Perfiles.php";

        // LOGIN
        document.getElementById("loginFormElement").addEventListener("submit", async function (event) {
            event.preventDefault();

            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();

            try {
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        action: "login",
                        username: username,
                        password: password
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showDashboard();
                } else {
                    document.getElementById("loginError").style.display = "block";
                }
            } catch (error) {
                console.error("Error al conectar con la API:", error);
                alert("Error al conectar con el servidor. Inténtalo más tarde.");
            }
        });

        // MOSTRAR DASHBOARD
        function showDashboard() {
            document.getElementById("loginForm").classList.add("hidden");
            document.getElementById("dashboard").classList.remove("hidden");
        }

        // CERRAR SESIÓN
        function logout() {
            document.getElementById("dashboard").classList.add("hidden");
            document.getElementById("loginForm").classList.remove("hidden");
        }

        // CARGAR MÓDULOS
        async function loadModule(moduleName) {
            const moduleContent = document.getElementById("module-content");

            try {
                const response = await fetch(`${apiUrl}?action=module&name=${moduleName}`);
                const data = await response.json();

                if (data.success) {
                    moduleContent.innerHTML = `<h4>${data.title}</h4><p>${data.description}</p>`;
                } else {
                    moduleContent.innerHTML = `<p>Error al cargar el módulo.</p>`;
                }
            } catch (error) {
                console.error("Error al cargar el módulo:", error);
                moduleContent.innerHTML = `<p>Error al conectar con la API.</p>`;
            }
        }
    </script>
</body>
</html>
