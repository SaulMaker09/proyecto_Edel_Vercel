<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Empleados</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-5">
        <h2>Listado de Empleados</h2>
        <button class="btn btn-primary mb-3" onclick="agregarEmpleado()">Agregar Empleado</button>
        <table id="empleados-table" class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido Paterno</th>
                    <th>Apellido Materno</th>
                    <th>Sexo</th>
                    <th>Fecha de Nacimiento</th>
                    <th>Puesto</th>
                    <th>Fecha de Contratación</th>
                    <th>Status</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>

        </tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            cargarEmpleados();  // Cargar los empleados 
        });

        function cargarEmpleados() {
    fetch('https://lavender-mandrill-842556.hostingersite.com/api/empleados.php')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(empleados => {
            console.log("Datos recibidos:", empleados); // Verificar los datos en la consola
            let tabla = document.getElementById("empleados-table").getElementsByTagName('tbody')[0];
            tabla.innerHTML = "";
            empleados.forEach(emp => {
                let fila = `<tr>
                    <td>${emp.id}</td>
                    <td>${emp.nombre}</td>
                    <td>${emp.apellido_paterno}</td>
                    <td>${emp.apellido_materno}</td>
                    <td>${emp.sexo}</td>
                    <td>${emp.fecha_nacimiento}</td>
                    <td>${emp.puesto}</td>
                    <td>${emp.fecha_contratacion}</td>
                    <td>${emp.status}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editarEmpleado(${emp.id})">Editar</button>
                        <button class="btn btn-danger btn-sm" onclick="eliminarEmpleado(${emp.id})">Eliminar</button>
                    </td>
                </tr>`;
                tabla.innerHTML += fila;
            });
        })
        .catch(error => {
            console.error('Error al cargar los empleados:', error);
            Swal.fire('Error', 'No se pudieron cargar los empleados: ' + error.message, 'error');
        });
}


function agregarEmpleado() {
    Swal.fire({
        title: "Agregar Nuevo Empleado",
        html: `
            <input id="nombre" class="swal2-input" placeholder="Nombre">
            <input id="apellido_paterno" class="swal2-input" placeholder="Apellido Paterno">
            <input id="apellido_materno" class="swal2-input" placeholder="Apellido Materno">
            <input id="sexo" class="swal2-input" placeholder="Sexo (M/F)">
            <input id="fecha_nacimiento" class="swal2-input" type="date">
            <input id="puesto" class="swal2-input" placeholder="Puesto">
            <input id="fecha_contratacion" class="swal2-input" type="date">
            <input id="status" class="swal2-input" placeholder="Status">
        `,
        showCancelButton: true,
        confirmButtonText: "Guardar",
        preConfirm: () => {
            return {
                nombre: document.getElementById("nombre").value,
                apellido_paterno: document.getElementById("apellido_paterno").value,
                apellido_materno: document.getElementById("apellido_materno").value,
                sexo: document.getElementById("sexo").value,
                fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
                puesto: document.getElementById("puesto").value,
                fecha_contratacion: document.getElementById("fecha_contratacion").value,
                status: document.getElementById("status").value
            };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            fetch("https://lavender-mandrill-842556.hostingersite.com/api/empleados.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(result.value)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire("Agregado!", "El empleado ha sido agregado.", "success");
                    cargarEmpleados(); // Recargar la tabla
                } else {
                    Swal.fire("Error", data.error, "error");
                }
            })
            .catch(error => {
                console.error("Error al agregar:", error);
                Swal.fire("Error", "No se pudo agregar el empleado.", "error");
            });
        }
    });
}

function editarEmpleado(id) {
    // Primero, obtenemos los datos del empleado a editar
    fetch(`https://lavender-mandrill-842556.hostingersite.com/api/empleados.php?id=${id}`)
        .then(response => response.json())
        .then(empleado => {
            console.log("Empleado a editar:", empleado); // Verifica si los datos del empleado llegan correctamente

            // Verifica que los datos no estén vacíos
            if (empleado && empleado.id) {
                // Luego mostramos el formulario de edición con los datos actuales
                Swal.fire({
                    title: "Editar Empleado",
                    html: `
                        <div class="form-group">
                            <label for="nombre">Nombre</label>
                            <input id="nombre" class="swal2-input form-control" value="${empleado.nombre || ''}" placeholder="Nombre">
                        </div>
                        <div class="form-group">
                            <label for="apellido_paterno">Apellido Paterno</label>
                            <input id="apellido_paterno" class="swal2-input form-control" value="${empleado.apellido_paterno || ''}" placeholder="Apellido Paterno">
                        </div>
                        <div class="form-group">
                            <label for="apellido_materno">Apellido Materno</label>
                            <input id="apellido_materno" class="swal2-input form-control" value="${empleado.apellido_materno || ''}" placeholder="Apellido Materno">
                        </div>
                        <div class="form-group">
                            <label for="sexo">Sexo</label>
                            <select id="sexo" class="swal2-input form-control">
                                <option value="M" ${empleado.sexo === "M" ? "selected" : ""}>Masculino</option>
                                <option value="F" ${empleado.sexo === "F" ? "selected" : ""}>Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fecha_nacimiento">Fecha de Nacimiento</label>
                            <input id="fecha_nacimiento" class="swal2-input form-control" type="date" value="${empleado.fecha_nacimiento || ''}">
                        </div>
                        <div class="form-group">
                            <label for="puesto">Puesto</label>
                            <input id="puesto" class="swal2-input form-control" value="${empleado.puesto || ''}" placeholder="Puesto">
                        </div>
                        <div class="form-group">
                            <label for="fecha_contratacion">Fecha de Contratación</label>
                            <input id="fecha_contratacion" class="swal2-input form-control" type="date" value="${empleado.fecha_contratacion || ''}">
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <input id="status" class="swal2-input form-control" value="${empleado.status || ''}" placeholder="Status">
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: "Guardar cambios",
                    cancelButtonText: "Cancelar",
                    confirmButtonColor: "#007bff", // Azul
                    cancelButtonColor: "#d33", // Rojo
                    preConfirm: () => {
                        return {
                            id: id,
                            nombre: document.getElementById("nombre").value,
                            apellido_paterno: document.getElementById("apellido_paterno").value,
                            apellido_materno: document.getElementById("apellido_materno").value,
                            sexo: document.getElementById("sexo").value,
                            fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
                            puesto: document.getElementById("puesto").value,
                            fecha_contratacion: document.getElementById("fecha_contratacion").value,
                            status: document.getElementById("status").value
                        };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch("https://lavender-mandrill-842556.hostingersite.com/api/empleados.php", {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(result.value)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire("Actualizado!", "El empleado ha sido actualizado.", "success");
                                cargarEmpleados(); // Recargar la tabla con los datos actualizados
                            } else {
                                Swal.fire("Error", data.error, "error");
                            }
                        })
                        .catch(error => {
                            console.error("Error al editar:", error);
                            Swal.fire("Error", "No se pudo actualizar el empleado.", "error");
                        });
                    }
                });
            } else {
                Swal.fire("Error", "No se encontraron datos para este empleado.", "error");
            }
        })
        .catch(error => {
            console.error("Error al obtener los datos del empleado:", error);
            Swal.fire("Error", "No se pudo cargar la información del empleado.", "error");
        });
}


function eliminarEmpleado(id) {
    Swal.fire({
        title: "¿Estás seguro?",
        text: "No podrás revertir esta acción!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
        confirmButtonText: "Sí, eliminar!"
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`https://lavender-mandrill-842556.hostingersite.com/api/empleados.php?id=${id}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire("Eliminado!", "El empleado ha sido eliminado.", "success");
                    cargarEmpleados(); // Volver a cargar la lista
                } else {
                    Swal.fire("Error", data.error, "error");
                }
            })
            .catch(error => {
                console.error("Error al eliminar:", error);
                Swal.fire("Error", "No se pudo eliminar el empleado.", "error");
            });
        }
    });
}


    </script>
</body>
</html>